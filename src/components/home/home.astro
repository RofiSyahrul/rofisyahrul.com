---
import Footer from '@/shared/components/footer.astro';
import BaseHeader from '@/shared/components/header/base-header.astro';
import Spotify from '@/shared/icons/spotify.svelte';

import Bio from './components/bio.astro';
import Counts from './components/counts.astro';
import Highlights from './components/highlights/highlights.astro';
import NowPlaying from './components/now-playing/now-playing.svelte';
import PortfolioGrid from './components/portfolio/portfolio-grid.astro';
import TopFold from './components/top-fold/top-fold.astro';
import type { HomeData } from './types';

type Props = HomeData;

const {
  portfolio,
  hasRecentlyPlayedTracks,
  hasTopTracks,
  spotifyNowPlaying,
} = Astro.props;

const { feeds } = portfolio;
const hasStories =
  hasRecentlyPlayedTracks || !!spotifyNowPlaying?.previewURL;
---

<BaseHeader transitionPersist='home-header' />

<main transition:persist>
  <TopFold {hasStories} />

  <Bio section='main' />

  {hasTopTracks && <Highlights />}

  <section class='sm:hidden'>
    <Counts />
  </section>

  <PortfolioGrid {feeds} />

  <section class='now-playing'>
    <NowPlaying data={spotifyNowPlaying} client:visible>
      <Fragment slot='title'>
        <Spotify class='text-secondary-bright' />
        <h3>Now Playing</h3>
      </Fragment>
    </NowPlaying>
  </section>
</main>

<Footer transitionPersist='home-footer' />

<style>
  main {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 1024px;
    padding: 12px 0;
    margin: 0 auto;
  }

  .now-playing {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-width: calc(100% - 32px);
    min-width: 250px;
    padding: 8px;
    margin: 0 auto;
    background-color: var(--color-neutral-bright0);
    border-radius: 8px;
  }

  :global(.dark) .now-playing {
    background-color: var(--color-neutral-dim0);
  }

  .now-playing h3 {
    flex: 1;
    font-weight: 700;
  }

  @media (min-width: 1024px) {
    .now-playing {
      position: fixed;
      bottom: 8px;
      right: 8px;
      padding: 12px;
      max-width: 320px;
    }
  }
</style>
